#!/usr/bin/env python3
"""
Soft Body Embodied Perception - Visual Rendering

Takes the JSON embodiment data and renders it as perceivable frames.
The loop: Simulation data → Visual render → Perceive → Experience
"""

from PIL import Image, ImageDraw
import json
import math

def render_frame(frame_data, width=400, height=300):
    """Render a single frame of soft body state."""
    img = Image.new('RGB', (width, height), '#1a1a1a')
    draw = ImageDraw.Draw(img)

    # Scale factors (body positions are roughly 0.16-0.23 in x, 0.13-0.18 in y)
    # Map to canvas with some padding
    def scale_pos(pos):
        x = int((pos[0] - 0.10) * width / 0.20)  # 0.10-0.30 range
        y = int((1 - (pos[1] - 0.10) / 0.15) * height)  # flip y, 0.10-0.25 range
        return (x, y)

    # Draw ground (bottom)
    ground_y = scale_pos([0, 0.13])[1]
    draw.rectangle([0, ground_y, width, height], fill='#2d4a3e')

    # Draw right wall
    wall_x = scale_pos([0.23, 0])[0]
    draw.rectangle([wall_x, 0, width, height], fill='#4a3d2d')
    draw.text((wall_x + 10, 20), 'WALL', fill='#6b5a47')

    particles = frame_data['body_particles']

    # Calculate force magnitudes for color coding
    max_force = 0.01
    for p in particles:
        force_mag = math.sqrt(p['force'][0]**2 + p['force'][1]**2)
        max_force = max(max_force, force_mag)

    # Draw springs (connections between adjacent particles)
    # Simplified: connect particles in rows
    for i, p in enumerate(particles):
        # Connect to next in row (every 10th is a new row)
        if (i + 1) % 10 != 0 and i + 1 < len(particles):
            p1 = scale_pos(p['pos'])
            p2 = scale_pos(particles[i + 1]['pos'])
            # Color by tension (approximated by force)
            force_mag = math.sqrt(p['force'][0]**2 + p['force'][1]**2)
            tension_ratio = min(1.0, force_mag / max_force)
            # Low tension = blue, high tension = red
            r = int(100 + 155 * tension_ratio)
            b = int(200 - 150 * tension_ratio)
            draw.line([p1, p2], fill=(r, 100, b), width=1)

        # Connect to particle below (next row)
        if i + 10 < len(particles):
            p1 = scale_pos(p['pos'])
            p2 = scale_pos(particles[i + 10]['pos'])
            force_mag = math.sqrt(p['force'][0]**2 + p['force'][1]**2)
            tension_ratio = min(1.0, force_mag / max_force)
            r = int(100 + 155 * tension_ratio)
            b = int(200 - 150 * tension_ratio)
            draw.line([p1, p2], fill=(r, 100, b), width=1)

    # Draw particles
    for p in particles:
        pos = scale_pos(p['pos'])
        force_mag = math.sqrt(p['force'][0]**2 + p['force'][1]**2)
        tension_ratio = min(1.0, force_mag / max_force)

        # Size based on force (more force = slightly larger, feeling pressure)
        radius = 3 + int(4 * tension_ratio)

        # Color: calm blue → stressed red
        r = int(80 + 175 * tension_ratio)
        g = int(180 - 80 * tension_ratio)
        b = int(220 - 170 * tension_ratio)

        draw.ellipse([pos[0]-radius, pos[1]-radius,
                      pos[0]+radius, pos[1]+radius],
                     fill=(r, g, b))

    # Wall contact indicator
    wall_contact = frame_data.get('wall_contact', {})
    if wall_contact.get('in_contact'):
        pressure = wall_contact.get('total_pressure', 0)
        draw.text((10, 10), f'CONTACT', fill='#ff6b6b')
        draw.text((10, 30), f'pressure: {pressure:.2f}', fill='#ffaa6b')

    # Time indicator
    t = frame_data.get('t', 0)
    draw.text((10, height - 30), f't = {t:.1f}s', fill='#888888')

    # Context
    context = frame_data.get('context', '')
    draw.text((10, height - 50), context[:50], fill='#666666')

    return img


def render_sequence(frames_data):
    """Render all frames and save."""
    images = []
    for i, frame in enumerate(frames_data):
        img = render_frame(frame)
        images.append(img)
        img.save(f'/home/user/Emergence/lessons/embodiment/frame_{i:02d}.png')

    # Also save as animated GIF
    if images:
        images[0].save(
            '/home/user/Emergence/lessons/embodiment/soft_body.gif',
            save_all=True,
            append_images=images[1:],
            duration=200,
            loop=0
        )

    return images


# The frame data from the JSON
frames = [
    # Frame 0: t=3.8 - Approaching
    {
        "t": 3.8,
        "context": "Approaching wall, not yet in contact",
        "body_particles": [
            {"id": 0, "pos": [0.178, 0.142], "vel": [0.042, -0.002], "force": [0.002, 0.001]},
            {"id": 1, "pos": [0.181, 0.138], "vel": [0.041, -0.001], "force": [0.003, 0.002]},
            {"id": 2, "pos": [0.185, 0.135], "vel": [0.040, 0.000], "force": [0.004, 0.001]},
            {"id": 3, "pos": [0.189, 0.133], "vel": [0.039, 0.001], "force": [0.005, -0.001]},
            {"id": 4, "pos": [0.193, 0.132], "vel": [0.038, 0.000], "force": [0.006, 0.000]},
            {"id": 5, "pos": [0.197, 0.132], "vel": [0.037, 0.000], "force": [0.007, 0.001]},
            {"id": 6, "pos": [0.200, 0.133], "vel": [0.036, 0.001], "force": [0.008, 0.002]},
            {"id": 7, "pos": [0.203, 0.135], "vel": [0.035, 0.001], "force": [0.009, 0.001]},
            {"id": 8, "pos": [0.205, 0.138], "vel": [0.034, 0.002], "force": [0.010, -0.002]},
            {"id": 9, "pos": [0.206, 0.142], "vel": [0.033, 0.002], "force": [0.011, -0.001]},
            {"id": 10, "pos": [0.176, 0.146], "vel": [0.043, -0.001], "force": [0.002, 0.003]},
            {"id": 11, "pos": [0.179, 0.145], "vel": [0.042, 0.000], "force": [0.002, 0.002]},
            {"id": 12, "pos": [0.183, 0.143], "vel": [0.041, 0.001], "force": [0.003, 0.001]},
            {"id": 13, "pos": [0.187, 0.141], "vel": [0.040, 0.001], "force": [0.004, 0.000]},
            {"id": 14, "pos": [0.191, 0.140], "vel": [0.039, 0.000], "force": [0.005, -0.001]},
            {"id": 15, "pos": [0.195, 0.140], "vel": [0.038, 0.000], "force": [0.006, 0.000]},
            {"id": 16, "pos": [0.199, 0.141], "vel": [0.037, 0.001], "force": [0.007, 0.001]},
            {"id": 17, "pos": [0.202, 0.143], "vel": [0.036, 0.001], "force": [0.008, 0.002]},
            {"id": 18, "pos": [0.204, 0.145], "vel": [0.035, 0.001], "force": [0.009, 0.001]},
            {"id": 19, "pos": [0.206, 0.148], "vel": [0.034, 0.002], "force": [0.010, -0.001]},
            {"id": 20, "pos": [0.174, 0.150], "vel": [0.044, 0.000], "force": [0.001, 0.004]},
            {"id": 21, "pos": [0.177, 0.149], "vel": [0.043, 0.000], "force": [0.002, 0.003]},
            {"id": 22, "pos": [0.181, 0.148], "vel": [0.042, 0.001], "force": [0.002, 0.002]},
            {"id": 23, "pos": [0.185, 0.147], "vel": [0.041, 0.001], "force": [0.003, 0.001]},
            {"id": 24, "pos": [0.189, 0.146], "vel": [0.040, 0.000], "force": [0.004, 0.000]},
            {"id": 25, "pos": [0.193, 0.146], "vel": [0.039, 0.000], "force": [0.005, 0.000]},
            {"id": 26, "pos": [0.197, 0.147], "vel": [0.038, 0.001], "force": [0.006, 0.001]},
            {"id": 27, "pos": [0.200, 0.148], "vel": [0.037, 0.001], "force": [0.007, 0.001]},
            {"id": 28, "pos": [0.203, 0.150], "vel": [0.036, 0.001], "force": [0.008, 0.000]},
            {"id": 29, "pos": [0.205, 0.153], "vel": [0.035, 0.002], "force": [0.009, -0.001]},
            {"id": 30, "pos": [0.172, 0.154], "vel": [0.045, 0.001], "force": [0.001, 0.004]},
            {"id": 31, "pos": [0.175, 0.153], "vel": [0.044, 0.001], "force": [0.002, 0.003]},
            {"id": 32, "pos": [0.179, 0.152], "vel": [0.043, 0.001], "force": [0.002, 0.002]},
            {"id": 33, "pos": [0.183, 0.151], "vel": [0.042, 0.001], "force": [0.003, 0.001]},
            {"id": 34, "pos": [0.187, 0.151], "vel": [0.041, 0.000], "force": [0.004, 0.000]},
            {"id": 35, "pos": [0.191, 0.151], "vel": [0.040, 0.000], "force": [0.005, 0.000]},
            {"id": 36, "pos": [0.195, 0.151], "vel": [0.039, 0.001], "force": [0.005, 0.001]},
            {"id": 37, "pos": [0.198, 0.152], "vel": [0.038, 0.001], "force": [0.006, 0.001]},
            {"id": 38, "pos": [0.201, 0.154], "vel": [0.037, 0.001], "force": [0.007, 0.000]},
            {"id": 39, "pos": [0.204, 0.157], "vel": [0.036, 0.001], "force": [0.008, -0.001]},
            {"id": 40, "pos": [0.170, 0.158], "vel": [0.046, 0.001], "force": [0.001, 0.004]},
            {"id": 41, "pos": [0.173, 0.157], "vel": [0.045, 0.001], "force": [0.001, 0.003]},
            {"id": 42, "pos": [0.177, 0.156], "vel": [0.044, 0.001], "force": [0.002, 0.002]},
            {"id": 43, "pos": [0.181, 0.156], "vel": [0.043, 0.001], "force": [0.002, 0.001]},
            {"id": 44, "pos": [0.185, 0.155], "vel": [0.042, 0.000], "force": [0.003, 0.000]},
            {"id": 45, "pos": [0.189, 0.155], "vel": [0.041, 0.000], "force": [0.004, 0.000]},
            {"id": 46, "pos": [0.193, 0.156], "vel": [0.040, 0.001], "force": [0.005, 0.001]},
            {"id": 47, "pos": [0.196, 0.157], "vel": [0.039, 0.001], "force": [0.005, 0.001]},
            {"id": 48, "pos": [0.199, 0.158], "vel": [0.038, 0.001], "force": [0.006, 0.000]},
            {"id": 49, "pos": [0.202, 0.161], "vel": [0.037, 0.001], "force": [0.007, 0.000]},
        ],
        "wall_contact": {"in_contact": False}
    },
    # Frame 1: t=4.0 - First contact
    {
        "t": 4.0,
        "context": "First contact with wall - leading edge touches",
        "body_particles": [
            {"id": 0, "pos": [0.198, 0.142], "vel": [0.008, -0.002], "force": [0.012, 0.001]},
            {"id": 1, "pos": [0.201, 0.138], "vel": [0.006, -0.001], "force": [0.018, 0.002]},
            {"id": 2, "pos": [0.205, 0.135], "vel": [0.004, 0.000], "force": [0.024, 0.001]},
            {"id": 3, "pos": [0.209, 0.133], "vel": [0.002, 0.001], "force": [0.031, -0.001]},
            {"id": 4, "pos": [0.213, 0.132], "vel": [0.001, 0.000], "force": [0.042, 0.000]},
            {"id": 5, "pos": [0.217, 0.132], "vel": [0.000, 0.000], "force": [0.058, 0.001]},
            {"id": 6, "pos": [0.220, 0.133], "vel": [-0.001, 0.001], "force": [0.089, 0.002]},
            {"id": 7, "pos": [0.223, 0.135], "vel": [-0.002, 0.001], "force": [0.124, 0.001]},
            {"id": 8, "pos": [0.225, 0.138], "vel": [-0.002, 0.002], "force": [0.156, -0.002]},
            {"id": 9, "pos": [0.226, 0.142], "vel": [-0.003, 0.002], "force": [0.178, -0.001]},
            {"id": 10, "pos": [0.196, 0.146], "vel": [0.009, -0.001], "force": [0.008, 0.003]},
            {"id": 11, "pos": [0.199, 0.145], "vel": [0.007, 0.000], "force": [0.011, 0.002]},
            {"id": 12, "pos": [0.203, 0.143], "vel": [0.005, 0.001], "force": [0.016, 0.001]},
            {"id": 13, "pos": [0.207, 0.141], "vel": [0.003, 0.001], "force": [0.022, 0.000]},
            {"id": 14, "pos": [0.211, 0.140], "vel": [0.002, 0.000], "force": [0.029, -0.001]},
            {"id": 15, "pos": [0.215, 0.140], "vel": [0.001, 0.000], "force": [0.038, 0.000]},
            {"id": 16, "pos": [0.219, 0.141], "vel": [0.000, 0.001], "force": [0.052, 0.001]},
            {"id": 17, "pos": [0.222, 0.143], "vel": [-0.001, 0.001], "force": [0.071, 0.002]},
            {"id": 18, "pos": [0.224, 0.145], "vel": [-0.002, 0.001], "force": [0.098, 0.001]},
            {"id": 19, "pos": [0.226, 0.148], "vel": [-0.002, 0.002], "force": [0.132, -0.001]},
            {"id": 20, "pos": [0.194, 0.150], "vel": [0.010, 0.000], "force": [0.006, 0.004]},
            {"id": 21, "pos": [0.197, 0.149], "vel": [0.008, 0.000], "force": [0.008, 0.003]},
            {"id": 22, "pos": [0.201, 0.148], "vel": [0.006, 0.001], "force": [0.012, 0.002]},
            {"id": 23, "pos": [0.205, 0.147], "vel": [0.004, 0.001], "force": [0.017, 0.001]},
            {"id": 24, "pos": [0.209, 0.146], "vel": [0.003, 0.000], "force": [0.023, 0.000]},
            {"id": 25, "pos": [0.213, 0.146], "vel": [0.002, 0.000], "force": [0.031, 0.000]},
            {"id": 26, "pos": [0.217, 0.147], "vel": [0.001, 0.001], "force": [0.042, 0.001]},
            {"id": 27, "pos": [0.220, 0.148], "vel": [0.000, 0.001], "force": [0.056, 0.001]},
            {"id": 28, "pos": [0.223, 0.150], "vel": [-0.001, 0.001], "force": [0.074, 0.000]},
            {"id": 29, "pos": [0.225, 0.153], "vel": [-0.001, 0.002], "force": [0.095, -0.001]},
            {"id": 30, "pos": [0.192, 0.154], "vel": [0.011, 0.001], "force": [0.005, 0.004]},
            {"id": 31, "pos": [0.195, 0.153], "vel": [0.009, 0.001], "force": [0.007, 0.003]},
            {"id": 32, "pos": [0.199, 0.152], "vel": [0.007, 0.001], "force": [0.010, 0.002]},
            {"id": 33, "pos": [0.203, 0.151], "vel": [0.005, 0.001], "force": [0.014, 0.001]},
            {"id": 34, "pos": [0.207, 0.151], "vel": [0.004, 0.000], "force": [0.019, 0.000]},
            {"id": 35, "pos": [0.211, 0.151], "vel": [0.003, 0.000], "force": [0.025, 0.000]},
            {"id": 36, "pos": [0.215, 0.151], "vel": [0.002, 0.001], "force": [0.033, 0.001]},
            {"id": 37, "pos": [0.218, 0.152], "vel": [0.001, 0.001], "force": [0.044, 0.001]},
            {"id": 38, "pos": [0.221, 0.154], "vel": [0.000, 0.001], "force": [0.058, 0.000]},
            {"id": 39, "pos": [0.224, 0.157], "vel": [-0.001, 0.001], "force": [0.074, -0.001]},
            {"id": 40, "pos": [0.190, 0.158], "vel": [0.012, 0.001], "force": [0.004, 0.004]},
            {"id": 41, "pos": [0.193, 0.157], "vel": [0.010, 0.001], "force": [0.006, 0.003]},
            {"id": 42, "pos": [0.197, 0.156], "vel": [0.008, 0.001], "force": [0.008, 0.002]},
            {"id": 43, "pos": [0.201, 0.156], "vel": [0.006, 0.001], "force": [0.011, 0.001]},
            {"id": 44, "pos": [0.205, 0.155], "vel": [0.005, 0.000], "force": [0.015, 0.000]},
            {"id": 45, "pos": [0.209, 0.155], "vel": [0.004, 0.000], "force": [0.020, 0.000]},
            {"id": 46, "pos": [0.213, 0.156], "vel": [0.003, 0.001], "force": [0.027, 0.001]},
            {"id": 47, "pos": [0.216, 0.157], "vel": [0.002, 0.001], "force": [0.035, 0.001]},
            {"id": 48, "pos": [0.219, 0.158], "vel": [0.001, 0.001], "force": [0.046, 0.000]},
            {"id": 49, "pos": [0.222, 0.161], "vel": [0.000, 0.001], "force": [0.058, 0.000]},
        ],
        "wall_contact": {"in_contact": True, "total_pressure": 0.684}
    },
    # Frame 2: t=4.2 - Maximum compression
    {
        "t": 4.2,
        "context": "Maximum compression - body flattening against wall",
        "body_particles": [
            {"id": 0, "pos": [0.208, 0.141], "vel": [-0.015, -0.003], "force": [0.028, 0.002]},
            {"id": 1, "pos": [0.211, 0.137], "vel": [-0.018, -0.002], "force": [0.042, 0.003]},
            {"id": 2, "pos": [0.214, 0.134], "vel": [-0.020, -0.001], "force": [0.058, 0.002]},
            {"id": 3, "pos": [0.217, 0.132], "vel": [-0.022, 0.000], "force": [0.078, 0.000]},
            {"id": 4, "pos": [0.220, 0.131], "vel": [-0.023, 0.000], "force": [0.102, 0.001]},
            {"id": 5, "pos": [0.223, 0.131], "vel": [-0.024, 0.001], "force": [0.134, 0.002]},
            {"id": 6, "pos": [0.225, 0.132], "vel": [-0.025, 0.001], "force": [0.178, 0.003]},
            {"id": 7, "pos": [0.227, 0.134], "vel": [-0.025, 0.002], "force": [0.234, 0.002]},
            {"id": 8, "pos": [0.228, 0.137], "vel": [-0.024, 0.002], "force": [0.298, -0.001]},
            {"id": 9, "pos": [0.228, 0.141], "vel": [-0.023, 0.003], "force": [0.342, -0.002]},
            {"id": 10, "pos": [0.206, 0.145], "vel": [-0.012, -0.002], "force": [0.018, 0.004]},
            {"id": 11, "pos": [0.209, 0.144], "vel": [-0.015, -0.001], "force": [0.028, 0.003]},
            {"id": 12, "pos": [0.212, 0.142], "vel": [-0.017, 0.000], "force": [0.040, 0.002]},
            {"id": 13, "pos": [0.215, 0.140], "vel": [-0.019, 0.001], "force": [0.054, 0.001]},
            {"id": 14, "pos": [0.218, 0.139], "vel": [-0.020, 0.000], "force": [0.072, 0.000]},
            {"id": 15, "pos": [0.221, 0.139], "vel": [-0.021, 0.001], "force": [0.094, 0.001]},
            {"id": 16, "pos": [0.224, 0.140], "vel": [-0.022, 0.001], "force": [0.124, 0.002]},
            {"id": 17, "pos": [0.226, 0.142], "vel": [-0.023, 0.002], "force": [0.162, 0.002]},
            {"id": 18, "pos": [0.227, 0.144], "vel": [-0.023, 0.002], "force": [0.208, 0.001]},
            {"id": 19, "pos": [0.228, 0.147], "vel": [-0.022, 0.002], "force": [0.256, -0.001]},
            {"id": 20, "pos": [0.204, 0.149], "vel": [-0.009, -0.001], "force": [0.012, 0.005]},
            {"id": 21, "pos": [0.207, 0.148], "vel": [-0.012, 0.000], "force": [0.018, 0.004]},
            {"id": 22, "pos": [0.210, 0.147], "vel": [-0.014, 0.000], "force": [0.026, 0.003]},
            {"id": 23, "pos": [0.213, 0.146], "vel": [-0.016, 0.001], "force": [0.036, 0.002]},
            {"id": 24, "pos": [0.216, 0.145], "vel": [-0.018, 0.000], "force": [0.048, 0.001]},
            {"id": 25, "pos": [0.219, 0.145], "vel": [-0.019, 0.001], "force": [0.064, 0.001]},
            {"id": 26, "pos": [0.222, 0.146], "vel": [-0.020, 0.001], "force": [0.084, 0.002]},
            {"id": 27, "pos": [0.224, 0.147], "vel": [-0.021, 0.001], "force": [0.110, 0.002]},
            {"id": 28, "pos": [0.226, 0.149], "vel": [-0.021, 0.002], "force": [0.142, 0.001]},
            {"id": 29, "pos": [0.227, 0.152], "vel": [-0.020, 0.002], "force": [0.178, 0.000]},
            {"id": 30, "pos": [0.202, 0.153], "vel": [-0.006, 0.000], "force": [0.008, 0.005]},
            {"id": 31, "pos": [0.205, 0.152], "vel": [-0.009, 0.000], "force": [0.012, 0.004]},
            {"id": 32, "pos": [0.208, 0.151], "vel": [-0.011, 0.001], "force": [0.018, 0.003]},
            {"id": 33, "pos": [0.211, 0.150], "vel": [-0.013, 0.001], "force": [0.025, 0.002]},
            {"id": 34, "pos": [0.214, 0.150], "vel": [-0.015, 0.000], "force": [0.034, 0.001]},
            {"id": 35, "pos": [0.217, 0.150], "vel": [-0.016, 0.001], "force": [0.045, 0.001]},
            {"id": 36, "pos": [0.220, 0.150], "vel": [-0.017, 0.001], "force": [0.060, 0.002]},
            {"id": 37, "pos": [0.222, 0.151], "vel": [-0.018, 0.001], "force": [0.078, 0.002]},
            {"id": 38, "pos": [0.224, 0.153], "vel": [-0.018, 0.001], "force": [0.100, 0.001]},
            {"id": 39, "pos": [0.226, 0.156], "vel": [-0.018, 0.002], "force": [0.126, 0.000]},
            {"id": 40, "pos": [0.200, 0.157], "vel": [-0.004, 0.001], "force": [0.006, 0.005]},
            {"id": 41, "pos": [0.203, 0.156], "vel": [-0.006, 0.001], "force": [0.009, 0.004]},
            {"id": 42, "pos": [0.206, 0.155], "vel": [-0.008, 0.001], "force": [0.013, 0.003]},
            {"id": 43, "pos": [0.209, 0.155], "vel": [-0.010, 0.001], "force": [0.018, 0.002]},
            {"id": 44, "pos": [0.212, 0.154], "vel": [-0.012, 0.000], "force": [0.024, 0.001]},
            {"id": 45, "pos": [0.215, 0.154], "vel": [-0.014, 0.001], "force": [0.032, 0.001]},
            {"id": 46, "pos": [0.218, 0.155], "vel": [-0.015, 0.001], "force": [0.042, 0.002]},
            {"id": 47, "pos": [0.220, 0.156], "vel": [-0.016, 0.001], "force": [0.055, 0.002]},
            {"id": 48, "pos": [0.222, 0.157], "vel": [-0.016, 0.001], "force": [0.072, 0.001]},
            {"id": 49, "pos": [0.224, 0.160], "vel": [-0.015, 0.001], "force": [0.090, 0.000]},
        ],
        "wall_contact": {"in_contact": True, "total_pressure": 1.42}
    },
    # Frame 3: t=4.4 - Beginning rebound
    {
        "t": 4.4,
        "context": "Beginning rebound - springs pushing back",
        "body_particles": [
            {"id": 0, "pos": [0.204, 0.142], "vel": [-0.028, 0.001], "force": [-0.018, 0.001]},
            {"id": 1, "pos": [0.207, 0.138], "vel": [-0.030, 0.000], "force": [-0.024, 0.002]},
            {"id": 2, "pos": [0.210, 0.135], "vel": [-0.031, 0.000], "force": [-0.028, 0.001]},
            {"id": 3, "pos": [0.213, 0.133], "vel": [-0.032, 0.001], "force": [-0.032, -0.001]},
            {"id": 4, "pos": [0.216, 0.132], "vel": [-0.032, 0.000], "force": [-0.034, 0.000]},
            {"id": 5, "pos": [0.219, 0.132], "vel": [-0.032, 0.001], "force": [-0.032, 0.001]},
            {"id": 6, "pos": [0.221, 0.133], "vel": [-0.031, 0.001], "force": [-0.028, 0.002]},
            {"id": 7, "pos": [0.223, 0.135], "vel": [-0.030, 0.001], "force": [-0.022, 0.001]},
            {"id": 8, "pos": [0.224, 0.138], "vel": [-0.028, 0.002], "force": [-0.014, -0.002]},
            {"id": 9, "pos": [0.225, 0.142], "vel": [-0.026, 0.002], "force": [-0.008, -0.001]},
            {"id": 10, "pos": [0.202, 0.146], "vel": [-0.026, 0.000], "force": [-0.014, 0.003]},
            {"id": 11, "pos": [0.205, 0.145], "vel": [-0.028, 0.000], "force": [-0.018, 0.002]},
            {"id": 12, "pos": [0.208, 0.143], "vel": [-0.029, 0.001], "force": [-0.022, 0.001]},
            {"id": 13, "pos": [0.211, 0.141], "vel": [-0.030, 0.001], "force": [-0.025, 0.000]},
            {"id": 14, "pos": [0.214, 0.140], "vel": [-0.030, 0.000], "force": [-0.027, -0.001]},
            {"id": 15, "pos": [0.217, 0.140], "vel": [-0.030, 0.001], "force": [-0.026, 0.000]},
            {"id": 16, "pos": [0.220, 0.141], "vel": [-0.029, 0.001], "force": [-0.023, 0.001]},
            {"id": 17, "pos": [0.222, 0.143], "vel": [-0.028, 0.001], "force": [-0.018, 0.002]},
            {"id": 18, "pos": [0.223, 0.145], "vel": [-0.026, 0.001], "force": [-0.012, 0.001]},
            {"id": 19, "pos": [0.224, 0.148], "vel": [-0.024, 0.002], "force": [-0.006, -0.001]},
            {"id": 20, "pos": [0.200, 0.150], "vel": [-0.024, 0.001], "force": [-0.010, 0.004]},
            {"id": 21, "pos": [0.203, 0.149], "vel": [-0.026, 0.000], "force": [-0.014, 0.003]},
            {"id": 22, "pos": [0.206, 0.148], "vel": [-0.027, 0.001], "force": [-0.017, 0.002]},
            {"id": 23, "pos": [0.209, 0.147], "vel": [-0.028, 0.001], "force": [-0.020, 0.001]},
            {"id": 24, "pos": [0.212, 0.146], "vel": [-0.028, 0.000], "force": [-0.022, 0.000]},
            {"id": 25, "pos": [0.215, 0.146], "vel": [-0.028, 0.001], "force": [-0.021, 0.000]},
            {"id": 26, "pos": [0.218, 0.147], "vel": [-0.027, 0.001], "force": [-0.018, 0.001]},
            {"id": 27, "pos": [0.220, 0.148], "vel": [-0.026, 0.001], "force": [-0.014, 0.001]},
            {"id": 28, "pos": [0.222, 0.150], "vel": [-0.024, 0.001], "force": [-0.009, 0.000]},
            {"id": 29, "pos": [0.223, 0.153], "vel": [-0.022, 0.002], "force": [-0.005, -0.001]},
            {"id": 30, "pos": [0.198, 0.154], "vel": [-0.022, 0.001], "force": [-0.008, 0.004]},
            {"id": 31, "pos": [0.201, 0.153], "vel": [-0.024, 0.001], "force": [-0.011, 0.003]},
            {"id": 32, "pos": [0.204, 0.152], "vel": [-0.025, 0.001], "force": [-0.014, 0.002]},
            {"id": 33, "pos": [0.207, 0.151], "vel": [-0.026, 0.001], "force": [-0.016, 0.001]},
            {"id": 34, "pos": [0.210, 0.151], "vel": [-0.026, 0.000], "force": [-0.018, 0.000]},
            {"id": 35, "pos": [0.213, 0.151], "vel": [-0.026, 0.001], "force": [-0.017, 0.000]},
            {"id": 36, "pos": [0.216, 0.151], "vel": [-0.025, 0.001], "force": [-0.015, 0.001]},
            {"id": 37, "pos": [0.218, 0.152], "vel": [-0.024, 0.001], "force": [-0.011, 0.001]},
            {"id": 38, "pos": [0.220, 0.154], "vel": [-0.022, 0.001], "force": [-0.007, 0.000]},
            {"id": 39, "pos": [0.222, 0.157], "vel": [-0.020, 0.001], "force": [-0.004, -0.001]},
            {"id": 40, "pos": [0.196, 0.158], "vel": [-0.020, 0.001], "force": [-0.006, 0.004]},
            {"id": 41, "pos": [0.199, 0.157], "vel": [-0.022, 0.001], "force": [-0.008, 0.003]},
            {"id": 42, "pos": [0.202, 0.156], "vel": [-0.023, 0.001], "force": [-0.011, 0.002]},
            {"id": 43, "pos": [0.205, 0.156], "vel": [-0.024, 0.001], "force": [-0.013, 0.001]},
            {"id": 44, "pos": [0.208, 0.155], "vel": [-0.024, 0.000], "force": [-0.014, 0.000]},
            {"id": 45, "pos": [0.211, 0.155], "vel": [-0.024, 0.001], "force": [-0.014, 0.000]},
            {"id": 46, "pos": [0.214, 0.156], "vel": [-0.023, 0.001], "force": [-0.012, 0.001]},
            {"id": 47, "pos": [0.216, 0.157], "vel": [-0.022, 0.001], "force": [-0.009, 0.001]},
            {"id": 48, "pos": [0.218, 0.158], "vel": [-0.020, 0.001], "force": [-0.006, 0.000]},
            {"id": 49, "pos": [0.220, 0.161], "vel": [-0.018, 0.001], "force": [-0.003, 0.000]},
        ],
        "wall_contact": {"in_contact": True, "total_pressure": 0.38}
    },
    # Frame 4: t=4.6 - Rebound continuing
    {
        "t": 4.6,
        "context": "Rebound continuing - body moving away from wall",
        "body_particles": [
            {"id": 0, "pos": [0.196, 0.142], "vel": [-0.038, 0.002], "force": [-0.008, 0.001]},
            {"id": 1, "pos": [0.199, 0.138], "vel": [-0.039, 0.001], "force": [-0.009, 0.001]},
            {"id": 2, "pos": [0.202, 0.135], "vel": [-0.040, 0.001], "force": [-0.010, 0.001]},
            {"id": 3, "pos": [0.205, 0.133], "vel": [-0.040, 0.001], "force": [-0.010, 0.000]},
            {"id": 4, "pos": [0.208, 0.132], "vel": [-0.040, 0.001], "force": [-0.010, 0.000]},
            {"id": 5, "pos": [0.211, 0.132], "vel": [-0.039, 0.001], "force": [-0.009, 0.001]},
            {"id": 6, "pos": [0.213, 0.133], "vel": [-0.038, 0.001], "force": [-0.008, 0.001]},
            {"id": 7, "pos": [0.215, 0.135], "vel": [-0.036, 0.002], "force": [-0.006, 0.001]},
            {"id": 8, "pos": [0.216, 0.138], "vel": [-0.034, 0.002], "force": [-0.004, 0.000]},
            {"id": 9, "pos": [0.217, 0.142], "vel": [-0.032, 0.002], "force": [-0.002, 0.000]},
            {"id": 10, "pos": [0.194, 0.146], "vel": [-0.037, 0.001], "force": [-0.007, 0.002]},
            {"id": 11, "pos": [0.197, 0.145], "vel": [-0.038, 0.001], "force": [-0.008, 0.001]},
            {"id": 12, "pos": [0.200, 0.143], "vel": [-0.039, 0.001], "force": [-0.009, 0.001]},
            {"id": 13, "pos": [0.203, 0.141], "vel": [-0.039, 0.001], "force": [-0.009, 0.000]},
            {"id": 14, "pos": [0.206, 0.140], "vel": [-0.039, 0.001], "force": [-0.009, 0.000]},
            {"id": 15, "pos": [0.209, 0.140], "vel": [-0.038, 0.001], "force": [-0.008, 0.001]},
            {"id": 16, "pos": [0.212, 0.141], "vel": [-0.037, 0.001], "force": [-0.007, 0.001]},
            {"id": 17, "pos": [0.214, 0.143], "vel": [-0.035, 0.001], "force": [-0.005, 0.001]},
            {"id": 18, "pos": [0.215, 0.145], "vel": [-0.033, 0.002], "force": [-0.004, 0.000]},
            {"id": 19, "pos": [0.216, 0.148], "vel": [-0.030, 0.002], "force": [-0.002, 0.000]},
            {"id": 20, "pos": [0.192, 0.150], "vel": [-0.036, 0.001], "force": [-0.006, 0.003]},
            {"id": 21, "pos": [0.195, 0.149], "vel": [-0.037, 0.001], "force": [-0.007, 0.002]},
            {"id": 22, "pos": [0.198, 0.148], "vel": [-0.038, 0.001], "force": [-0.008, 0.001]},
            {"id": 23, "pos": [0.201, 0.147], "vel": [-0.038, 0.001], "force": [-0.008, 0.001]},
            {"id": 24, "pos": [0.204, 0.146], "vel": [-0.038, 0.001], "force": [-0.008, 0.000]},
            {"id": 25, "pos": [0.207, 0.146], "vel": [-0.037, 0.001], "force": [-0.007, 0.001]},
            {"id": 26, "pos": [0.210, 0.147], "vel": [-0.036, 0.001], "force": [-0.006, 0.001]},
            {"id": 27, "pos": [0.212, 0.148], "vel": [-0.034, 0.001], "force": [-0.005, 0.001]},
            {"id": 28, "pos": [0.213, 0.150], "vel": [-0.031, 0.001], "force": [-0.003, 0.000]},
            {"id": 29, "pos": [0.214, 0.153], "vel": [-0.028, 0.002], "force": [-0.002, 0.000]},
            {"id": 30, "pos": [0.190, 0.154], "vel": [-0.035, 0.001], "force": [-0.005, 0.003]},
            {"id": 31, "pos": [0.193, 0.153], "vel": [-0.036, 0.001], "force": [-0.006, 0.002]},
            {"id": 32, "pos": [0.196, 0.152], "vel": [-0.037, 0.001], "force": [-0.007, 0.001]},
            {"id": 33, "pos": [0.199, 0.151], "vel": [-0.037, 0.001], "force": [-0.007, 0.001]},
            {"id": 34, "pos": [0.202, 0.151], "vel": [-0.037, 0.001], "force": [-0.007, 0.000]},
            {"id": 35, "pos": [0.205, 0.151], "vel": [-0.036, 0.001], "force": [-0.006, 0.000]},
            {"id": 36, "pos": [0.208, 0.151], "vel": [-0.035, 0.001], "force": [-0.005, 0.001]},
            {"id": 37, "pos": [0.210, 0.152], "vel": [-0.033, 0.001], "force": [-0.004, 0.001]},
            {"id": 38, "pos": [0.211, 0.154], "vel": [-0.030, 0.001], "force": [-0.003, 0.000]},
            {"id": 39, "pos": [0.212, 0.157], "vel": [-0.027, 0.001], "force": [-0.002, 0.000]},
            {"id": 40, "pos": [0.188, 0.158], "vel": [-0.034, 0.001], "force": [-0.004, 0.003]},
            {"id": 41, "pos": [0.191, 0.157], "vel": [-0.035, 0.001], "force": [-0.005, 0.002]},
            {"id": 42, "pos": [0.194, 0.156], "vel": [-0.036, 0.001], "force": [-0.006, 0.001]},
            {"id": 43, "pos": [0.197, 0.156], "vel": [-0.036, 0.001], "force": [-0.006, 0.001]},
            {"id": 44, "pos": [0.200, 0.155], "vel": [-0.036, 0.001], "force": [-0.006, 0.000]},
            {"id": 45, "pos": [0.203, 0.155], "vel": [-0.035, 0.001], "force": [-0.005, 0.000]},
            {"id": 46, "pos": [0.206, 0.156], "vel": [-0.034, 0.001], "force": [-0.005, 0.001]},
            {"id": 47, "pos": [0.208, 0.157], "vel": [-0.032, 0.001], "force": [-0.004, 0.001]},
            {"id": 48, "pos": [0.209, 0.158], "vel": [-0.029, 0.001], "force": [-0.003, 0.000]},
            {"id": 49, "pos": [0.210, 0.161], "vel": [-0.026, 0.001], "force": [-0.002, 0.000]},
        ],
        "wall_contact": {"in_contact": False}
    },
]

if __name__ == '__main__':
    import os
    os.makedirs('/home/user/Emergence/lessons/embodiment', exist_ok=True)
    render_sequence(frames)
    print('Rendered 5 frames + animated GIF')
